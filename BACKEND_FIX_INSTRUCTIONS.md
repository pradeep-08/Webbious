# Backend Fix Instructions

It appears your backend is missing some features both locally and in production.

## 1. Fix Missing AI Endpoint (Local & Production)
Your local specific testing shows `ai-insights` endpoint is missing (`Cannot GET ...`). You need to add this to your backend `index.js` or `server.js`.

**Prerequisite:**
Run this in your backend terminal:
```bash
npm install pdfkit
```

**Add this code to your backend `index.js` (before app.listen):**

```javascript
/* --- ADD THIS TO YOUR BACKEND index.js --- */
const PDFDocument = require('pdfkit');

// AI Insights Endpoint
app.get('/api/ai-insights/download', (req, res) => {
    const { subject_code } = req.query;

    if (!subject_code) {
        return res.status(400).json({ error: 'Subject code is required' });
    }

    try {
        const doc = new PDFDocument();
        const filename = `${subject_code}_AI_Insight.pdf`;

        res.setHeader('Content-Type', 'application/pdf');
        res.setHeader('Content-Disposition', `attachment; filename="${filename}"`);

        doc.pipe(res);

        // PDF Content
        doc.fontSize(20).text(`AI Exam Insights: ${subject_code}`, { align: 'center' });
        doc.moveDown();
        doc.fontSize(12).text(`Generated on: ${new Date().toLocaleDateString()}`, { align: 'center' });
        doc.moveDown();
        doc.fontSize(14).text('Key Topics & Analysis', { underline: true });
        doc.fontSize(12).text('1. Historical pattern analysis indicates high probability of Unit 3 questions.');
        doc.text('2. Focus on "5-mark" sections from 2019-2023 papers.');
        doc.text('3. This is a generated placeholder for AI-driven insights.');
        doc.moveDown();
        doc.fontSize(10).text('Disclaimer: Generated by AI. Use as a study aid only.', { align: 'center' });
        
        doc.end();

    } catch (error) {
        console.error('Error generating PDF:', error);
        res.status(500).json({ error: 'Failed to generate AI insights' });
    }
});
```

## 2. Fix "Production Not Working" (404 Error)
The error `404 Not Found` on Vercel means your local code changes (like `/api/papers`) have not been pushed to the server yet.

**Solution: Deploy your changes**

1. Open your **Terminal** and navigate to your **backend folder**.
2. Run these commands:

```bash
git status
# You should see modified files (index.js, etc.)

git add .
git commit -m "Add community papers and AI insights endpoints"
git push
```

3. Wait for Vercel to finish building.
4. Once deployment is complete, both the **Papers** search and **AI Insights** download will work in production.

---
**Note on Vercel File Uploads:**
If your `/api/papers/upload` uses local file storage (e.g., saving to a generic `uploads/` folder), it will **not persist** on Vercel because Vercel functions are serverless and read-only. For production file uploads, you should eventually migrate to AWS S3, Firebase Storage, or Vercel Blob.
